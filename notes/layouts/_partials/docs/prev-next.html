{{/* Project override: prev/next within the same folder (File.Dir) to avoid cross-section jumps */}}
{{ $dir := .File.Dir }}
{{ $siblings := where .Site.RegularPages "File.Dir" $dir }}
{{/* Prefer weight ordering if provided */}}
{{ $siblings = sort $siblings "Weight" }}
{{ $prev := nil }}
{{ $next := nil }}
{{ $idx := -1 }}
{{ range $i, $p := $siblings }}
  {{ if eq $p.RelPermalink $.RelPermalink }}{{ $idx = $i }}{{ end }}
{{ end }}
{{ if ge $idx 0 }}
  {{ if gt $idx 0 }}{{ $prev = index $siblings (sub $idx 1) }}{{ end }}
  {{ if lt (add $idx 1) (len $siblings) }}{{ $next = index $siblings (add $idx 1) }}{{ end }}
{{ end }}

{{/* Fallback: if no siblings (single file folder), try section neighbors */}}
{{ if and (not $prev) (not $next) }}
  {{ $secPages := .CurrentSection.RegularPages }}
  {{ $secPages = sort $secPages "Weight" }}
  {{ $idx = -1 }}
  {{ range $i, $p := $secPages }}
    {{ if eq $p.RelPermalink $.RelPermalink }}{{ $idx = $i }}{{ end }}
  {{ end }}
  {{ if ge $idx 0 }}
    {{ if gt $idx 0 }}{{ $prev = index $secPages (sub $idx 1) }}{{ end }}
    {{ if lt (add $idx 1) (len $secPages) }}{{ $next = index $secPages (add $idx 1) }}{{ end }}
  {{ end }}
{{ end }}

{{ if or $prev $next }}
<div class="flex flex-wrap justify-between">
  <span>
  {{ with $prev }}
    <a href="{{ .RelPermalink }}" class="flex align-center">
      <img src="{{ "svg/backward.svg" | relURL }}" class="book-icon" alt="Previous" title="{{ .Title }}" />
      <span>{{ .Title }}</span>
    </a>
  {{ end }}
  </span>
  <span>
  {{ with $next }}
    <a href="{{ .RelPermalink }}" class="flex align-center">
      <span>{{ .Title }}</span>
      <img src="{{ "svg/forward.svg" | relURL }}" class="book-icon" alt="Next" title="{{ .Title }}" />
    </a>
  {{ end }}
  </span>
</div>
{{ end }}
