{{/* Project override: robust prev/next. Skip non-page kinds (home, list, taxonomy). */}}
{{ if .IsPage }}
  {{- $prev := false -}}
  {{- $next := false -}}
  {{- $dir := "" -}}
  {{- with .File }}{{ $dir = .Dir }}{{ end -}}

  {{- /* Prefer siblings in the same directory when available */ -}}
  {{- $siblings := slice -}}
  {{- if $dir -}}
    {{- $siblings = where .Site.RegularPages "File.Dir" $dir -}}
  {{- end -}}
  {{- if gt (len $siblings) 0 -}}
    {{- $siblings = sort $siblings "Weight" "Title" -}}
    {{- $idx := -1 -}}
    {{- range $i, $p := $siblings -}}
      {{- if eq $p.RelPermalink $.RelPermalink -}}{{ $idx = $i }}{{- end -}}
    {{- end -}}
    {{- if ge $idx 0 -}}
      {{- if gt $idx 0 -}}{{ $prev = index $siblings (sub $idx 1) }}{{- end -}}
      {{- if lt (add $idx 1) (len $siblings) -}}{{ $next = index $siblings (add $idx 1) }}{{- end -}}
    {{- end -}}
  {{- end -}}

  {{- /* Fallback to section neighbors if needed */ -}}
  {{- if and (not $prev) (not $next) -}}
    {{- with .CurrentSection -}}
      {{- $secPages := sort .RegularPages "Weight" "Title" -}}
      {{- $idx := -1 -}}
      {{- range $i, $p := $secPages -}}
        {{- if eq $p.RelPermalink $.RelPermalink -}}{{ $idx = $i }}{{- end -}}
      {{- end -}}
      {{- if ge $idx 0 -}}
        {{- if gt $idx 0 -}}{{ $prev = index $secPages (sub $idx 1) }}{{- end -}}
        {{- if lt (add $idx 1) (len $secPages) -}}{{ $next = index $secPages (add $idx 1) }}{{- end -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}

  {{ if or $prev $next }}
<div class="flex flex-wrap justify-between">
  <span>
  {{ with $prev }}
    <a href="{{ .RelPermalink }}" class="flex align-center">
      <img src="{{ "svg/backward.svg" | relURL }}" class="book-icon" alt="Previous" title="{{ .Title }}" />
      <span>{{ .Title }}</span>
    </a>
  {{ end }}
  </span>
  <span>
  {{ with $next }}
    <a href="{{ .RelPermalink }}" class="flex align-center">
      <span>{{ .Title }}</span>
      <img src="{{ "svg/forward.svg" | relURL }}" class="book-icon" alt="Next" title="{{ .Title }}" />
    </a>
  {{ end }}
  </span>
</div>
  {{ end }}
{{ end }}
