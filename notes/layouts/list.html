{{ define "main" }}
<article class="markdown book-article">
  <h1>{{ .Title }}</h1>
  {{- with .Content }}{{ . }}{{ end -}}

  {{ template "section-tree" . }}
</article>
{{ end }}

{{/* Recursive section tree similar to sidebar file tree */}}
{{ define "section-tree" }}
  {{- $pages := where .Pages "Params.bookHidden" "ne" true -}}
  {{- if gt (len $pages) 0 -}}
  <ul>
    {{- range $pages -}}
      {{- if eq .File.BaseFileName "who_is_lovelybuggies" -}}
        {{- /* skip this special page from list */ -}}
      {{- else if .IsSection -}}
        <li class="section">
          <a href="{{ .RelPermalink }}">{{ partial "docs/title" . }}</a>
          {{ template "section-tree" . }}
        </li>
      {{- else if and .IsPage .Content -}}
        <li class="page">
          <a href="{{ .RelPermalink }}">{{ partial "docs/title" . }}</a>
        </li>
      {{- else if .IsPage -}}
        <li class="page">
          <a href="{{ .RelPermalink }}">{{ partial "docs/title" . }}</a>
        </li>
      {{- end -}}
    {{- end -}}
  </ul>
  {{- end -}}
{{ end }}
